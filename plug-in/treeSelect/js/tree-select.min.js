/*!
 * treeSelect v1.0.2
 *
 * 作者：王金城
 * 日期：2019年11月12日
 */
!function($){let constants_classes={zoomInTopLeaveActive:"el-zoom-in-top-leave-active",zoomInTopEnter:"el-zoom-in-top-enter",zoomInTopEnterActive:"el-zoom-in-top-enter-active",isFocus:"is-focus",cascader:"cascader",elPopper:"el-popper",popperArrow:"popper__arrow",activePath:"in-active-path",active:"is-active",d_block:"d-block"},constants_defaultAttrs={type:"text",autocomplete:"off",readonly:"readonly"},constants_html={dropdown:function(targetId,scrollbarWidth,scrollbarHeight){let panel;return'<div class="input-suffix"><i class="iconfont icon-arrow-up"></i></div><div class="tree-select-dropdown el-popper" x-placement="bottom-start">  <div class="popper__arrow"></div>  <div class="tree-select-panel el-scrollbar" id="treeSelect_panel_'+targetId+'">'+('<div class="tree-select-menu-wrap el-scrollbar__wrap" style="margin-right:'+scrollbarWidth+";margin-bottom:"+scrollbarHeight+';">  <ul class="el-scrollbar__view ztree" id="treeSelect_'+targetId+'"></ul></div><div class="el-scrollbar__bar is-horizontal"><div class="el-scrollbar__thumb"></div></div><div class="el-scrollbar__bar is-vertical"><div class="el-scrollbar__thumb"></div></div>')+"</div></div>"}},defaults={idKey:"id",pIdKey:"pId",rootPId:-1,name:"name",disabled:!1,onlySelectOne:!0,chkboxType:{Y:"s",N:"s"},showIcon:!1,separator:" / ",callback:{},beforeClick:function(treeId,treeNode,clickFlag){},onClick:function(event,treeId,treeNode){},onCheck:function(event,treeId,treeNode){}},checkedNodes={},methods={val:function(val){if(void 0===val){let values=[],config=this.config;return $.isEmptyObject(checkedNodes[this.targetId])?config.onlySelectOne?null:[]:config.onlySelectOne?checkedNodes[this.targetId][config.idKey]:($.each(checkedNodes[this.targetId],(function(i,node){values.push(node[config.idKey])})),values)}{let targetId=this.targetId,config=this.config,treeObj=$.fn.zTree.getZTreeObj("treeSelect_"+targetId);if($.isEmptyObject(val)||config.onlySelectOne){if(null!==val&&""!==val&&config.onlySelectOne){let node=treeObj.getNodeByParam(config.idKey,val);treeObj.selectNode(node),$("#"+targetId).attr("placeholder",node[config.name])}}else{let valLength=val.length;for(let i=0;i<valLength;i++){let node=treeObj.getNodeByParam(config.idKey,val[i]);treeObj.checkNode(node,!0,!0,!0),treeObj.selectNode(node)}}}},getCheckedNodes:function(){return this.config.onlySelectOne?checkedNodes[this.targetId]||{}:checkedNodes[this.targetId]||[]}};function findHideParentNodes(nodes,node){let pNode=node.getParentNode();pNode&&(pNode.isHidden&&nodes.push(pNode),findHideParentNodes(nodes,pNode))}function adjustPanelDirection($this,$cascader_dropdown){if($this&&$cascader_dropdown&&$this.length>0&&$cascader_dropdown.length>0){let bottom;$(window).height()-($this.offset().top-$(document).scrollTop())<=250?$cascader_dropdown.attr("x-placement","top-start"):$cascader_dropdown.attr("x-placement","bottom-start")}}function closePanel($treeSelect,$treeSelect_dropdown){if($treeSelect&&$treeSelect_dropdown&&$treeSelect.length>0&&$treeSelect_dropdown.length>0){let classes=constants_classes;$treeSelect_dropdown.addClass(classes.zoomInTopLeaveActive).addClass(classes.d_block),$treeSelect.removeClass(classes.isFocus),setTimeout((function(){$treeSelect_dropdown.removeClass(constants_classes.zoomInTopLeaveActive).removeClass(classes.d_block)}),300),$treeSelect.find("input").val("").attr("readonly","readonly")}}function initScrollbar(targetId,$scrollbar__wrap,$scrollbar__thumb,scrollbarHeight,wrapHeight){let viewHeight=$("#treeSelect_panel_"+targetId+" .el-scrollbar__view")[0].scrollHeight;wrapHeight<viewHeight&&$scrollbar__thumb.css("height",wrapHeight/viewHeight*100+"%"),setTimeout((function(){initScrollbar(targetId,$scrollbar__wrap,$scrollbar__thumb,scrollbarHeight,wrapHeight)}),10)}function getScrollBarWidthAndHeight(){let el=document.createElement("p"),styles={width:"100px",height:"100px",overflow:"scroll"};for(let i in styles)el.style[i]=styles[i];document.body.appendChild(el);let scrollBarWidth=el.offsetWidth-el.clientWidth,scrollBarHeight=el.offsetHeight-el.clientHeight;return el.remove(),[scrollBarWidth,scrollBarHeight]}$.fn.extend({treeSelect:function(options,data){if($(this).wrap('<div class="tree-select"></div>'),"object"!=typeof options)return this;let $treeSelectInput=$(this),targetId=$treeSelectInput.attr("id"),classes=constants_classes,html=constants_html,config=$.extend({},defaults,options),treeSelect={targetId:targetId,config:config},scrollbarWidthAndHeight=getScrollBarWidthAndHeight(),scrollbarWidth=scrollbarWidthAndHeight[0],scrollbarHeight=scrollbarWidthAndHeight[1];$treeSelectInput.attr(constants_defaultAttrs).after(html.dropdown(targetId,-scrollbarWidth+"px",-scrollbarHeight+"px")),config.disabled&&$treeSelectInput.attr("disabled","disabled");let $treeSelect=$treeSelectInput.parent(".tree-select"),$treeSelect_dropdown=$treeSelectInput.siblings(".tree-select-dropdown"),$input_suffix=$treeSelectInput.next(".input-suffix"),setting={view:{showIcon:config.showIcon},data:{simpleData:{enable:!0,idKey:config.idKey,pIdKey:config.pIdKey,rootPId:config.rootPId},key:{name:config.name}},check:{enable:!config.onlySelectOne,chkboxType:config.chkboxType},callback:config.callback};setting.callback.onCheck=function(event,treeId,treeNode){let treeObj,nodes=$.fn.zTree.getZTreeObj(treeId).getNodesByParam("checked",!0),namesAry=[];checkedNodes[targetId]=nodes,$.each(nodes,(function(i,node){namesAry.push(node[config.name])}));let names=namesAry.join(config.separator);$treeSelectInput.attr("placeholder",names).attr("title",names),config.onCheck(event,treeId,treeNode)},setting.callback.beforeClick=function(treeId,treeNode,clickFlag){let treeObj=$.fn.zTree.getZTreeObj(treeId),nodes=treeObj.getSelectedNodes();$.each(nodes,(function(i,node){treeObj.cancelSelectedNode(node)})),config.beforeClick(treeId,treeNode,clickFlag)},setting.callback.onClick=function(event,treeId,treeNode){config.onlySelectOne&&($treeSelectInput.attr("placeholder",treeNode[config.name]),checkedNodes[targetId]=treeNode,closePanel($treeSelect,$treeSelect_dropdown)),config.onClick(event,treeId,treeNode)};let treeSelectObj=$.fn.zTree.init($("#treeSelect_"+targetId),setting,data),$scrollbar__wrap=$("#treeSelect_panel_"+targetId+" .el-scrollbar__wrap"),$scrollbar__thumb=$("#treeSelect_panel_"+targetId+" .el-scrollbar__bar.is-vertical .el-scrollbar__thumb"),wrapHeight=$scrollbar__wrap.height()-scrollbarHeight;return initScrollbar(targetId,$scrollbar__wrap,$scrollbar__thumb,scrollbarHeight,wrapHeight),$scrollbar__wrap.on("scroll",(function(){$scrollbar__thumb.css("transform","translateY("+$(this).scrollTop()/wrapHeight*100+"%)")})),$input_suffix.on("click",(function(){$treeSelect.hasClass(classes.isFocus)?closePanel($treeSelect,$treeSelect_dropdown):$treeSelectInput.click()})),$treeSelectInput.on("click",(function(){$treeSelect.hasClass(classes.isFocus)||(adjustPanelDirection($treeSelectInput,$treeSelect_dropdown),$treeSelect_dropdown.addClass(classes.zoomInTopEnterActive).addClass(classes.zoomInTopEnter),$treeSelect.addClass(classes.isFocus),setTimeout((function(){$treeSelect_dropdown.removeClass(classes.zoomInTopEnter)}),7),setTimeout((function(){$treeSelect_dropdown.removeClass(classes.zoomInTopEnterActive)}),300),$treeSelectInput.removeAttr("readonly"),treeSelectObj.showNodes(treeSelectObj.getNodesByParam("isHidden",!0)))})).on("keyup",(function(){let searchKey=$.trim($(this).val());if(searchKey){let showNodes=treeSelectObj.getNodesByParam("isHidden",!1),nodes=treeSelectObj.getNodesByParamFuzzy(config.name,searchKey),hideParentNodes=[];treeSelectObj.hideNodes(showNodes),$.each(nodes,(function(i,node){findHideParentNodes(hideParentNodes,node)})),treeSelectObj.showNodes(hideParentNodes),treeSelectObj.showNodes(nodes)}else{let hideNodes=treeSelectObj.getNodesByParam("isHidden",!0);treeSelectObj.showNodes(hideNodes)}})),$(document).on("click",(function(e){$treeSelect.is(e.target)||0!==$treeSelect.has(e.target).length||$treeSelect.hasClass(classes.isFocus)&&closePanel($treeSelect,$treeSelect_dropdown)})),$(document).scroll((function(){adjustPanelDirection($treeSelectInput,$treeSelectInput.siblings(".tree-select-dropdown"))})),$.extend({},treeSelect,methods)}})}(jQuery);