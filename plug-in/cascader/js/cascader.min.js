/*!
 * cascader v1.0.5
 *
 * 作者：王金城
 * 日期：2021年4月28日
 */
!function($){let constants={icons:{inputSuffix:'<i class="iconfont icon-arrow-up input-suffix"></i>',nodePostfix:'<i class="iconfont icon-arrow-up cascader-node-postfix"></i>',nodePrefix:'<i class="iconfont icon-check cascader-node-prefix"></i>'},classes:{zoomInTopLeaveActive:"el-zoom-in-top-leave-active",zoomInTopEnter:"el-zoom-in-top-enter",zoomInTopEnterActive:"el-zoom-in-top-enter-active",isFocus:"is-focus",cascader:"cascader",elPopper:"el-popper",popperArrow:"popper__arrow",activePath:"in-active-path",active:"is-active",d_block:"d-block",is_disabled:"is-disabled"},defaultAttrs:{type:"text",autocomplete:"off",readonly:"readonly"},html:{dropdown:function(targetId){return'<div class="input-suffix"><i class="iconfont icon-arrow-up"></i></div><div class="cascader-dropdown el-popper" x-placement="bottom-start">  <div class="popper__arrow"></div>  <div class="cascader-panel" id="cascader_panel_'+targetId+'"></div></div>'},menu:function(menuitemHtml,level,targetId,scrollbarWidth,scrollbarHeight){return'<div class="el-scrollbar cascader-menu" role="menu" id="cascader_menu_'+targetId+"_"+level+'">  <div class="cascader-menu-wrap el-scrollbar__wrap" style="margin-right:'+scrollbarWidth+";margin-bottom:"+scrollbarHeight+';">    <ul class="el-scrollbar__view cascader-menu-list">'+menuitemHtml+'</ul>  </div>  <div class="el-scrollbar__bar is-horizontal"><div class="el-scrollbar__thumb"></div></div>  <div class="el-scrollbar__bar is-vertical"><div class="el-scrollbar__thumb"></div></div></div>'},node:function(option,config){let menuitem='<li class="cascader-node '+(1===option.isDisabled?"is-disabled":"")+'" role="menuitem" data-id="'+option[config.idKey]+'" data-level="'+option.level+'"><span class="cascader-node-label">'+option[config.name]+"</span>";return option.isParent?menuitem+=constants.icons.nodePostfix:menuitem+=constants.icons.nodePrefix,menuitem+="</li>",menuitem}}},defaults={idKey:"id",pIdKey:"pId",rootPId:-1,sortKey:"",name:"name",disabled:!1,separator:" / ",onClickNode:function(event,node){}},checkedNodes={},cascaderObjs={},methods={val:function(val){if(void 0===val){let values=[],config=this.config;return $.each(checkedNodes[this.targetId],(function(i,node){values.push(node[config.idKey])})),values}if(!$.isEmptyObject(val)){let targetId=this.targetId,disabledClass=constants.classes.is_disabled;$("#"+targetId).siblings(".cascader-dropdown").css({opacity:0,display:"block"});for(let i=0;i<val.length;i++){let $node=$("#cascader_panel_"+targetId).find(".cascader-node[data-id="+val[i]+"]"),is_disabled=$node.hasClass(disabledClass);$node.index()>5&&$node.parents(".el-scrollbar__wrap").animate({scrollTop:35*($node.index()-3)},20),is_disabled&&$node.removeClass(disabledClass),$node.click(),is_disabled&&$node.addClass(disabledClass)}setTimeout((function(){$("#"+targetId).siblings(".cascader-dropdown").css({opacity:"",display:""})}),300)}},getCheckedNodes:function(leafOnly){let nodes=checkedNodes[this.targetId];if(void 0===leafOnly||!1===leafOnly)return nodes||[];if(!$.isEmptyObject(nodes))for(let i=nodes.length-1;i>=0;i--){let node=nodes[i];if(!node.isParent)return node}return{}}};function adjustPanelDirection($this,$cascader_dropdown){if($this&&$cascader_dropdown&&$this.length>0&&$cascader_dropdown.length>0){let bottom;$(window).height()-($this.offset().top-$(document).scrollTop())<=250?$cascader_dropdown.attr("x-placement","top-start"):$cascader_dropdown.attr("x-placement","bottom-start")}}function closePanel($cascader,$cascader_dropdown){if($cascader&&$cascader_dropdown&&$cascader.length>0&&$cascader_dropdown.length>0){let classes=constants.classes;$cascader_dropdown.addClass(classes.zoomInTopLeaveActive).addClass(classes.d_block),$cascader.removeClass(classes.isFocus),setTimeout((function(){$cascader_dropdown.removeClass(classes.zoomInTopLeaveActive).removeClass(classes.d_block)}),300)}}function initScrollbar(targetId,level,scrollbarHeight){let $scrollbar__wrap=$("#cascader_menu_"+targetId+"_"+level+" .el-scrollbar__wrap"),$scrollbar__thumb=$("#cascader_menu_"+targetId+"_"+level+" .el-scrollbar__bar.is-vertical .el-scrollbar__thumb"),wrapHeight=$scrollbar__wrap.height()-scrollbarHeight,viewHeight=$("#cascader_menu_"+targetId+"_"+level+" .el-scrollbar__view")[0].scrollHeight;wrapHeight<viewHeight&&$scrollbar__thumb.css("height",wrapHeight/viewHeight*100+"%"),$scrollbar__wrap.off("scroll"),$scrollbar__wrap.on("scroll",(function(){$scrollbar__thumb.css("transform","translateY("+$(this).scrollTop()/wrapHeight*100+"%)")})),$scrollbar__thumb.off("mousedown"),$scrollbar__thumb.on("mousedown",(function(e){if(0===e.button){let gapY=e.clientY;console.log(gapY)}$(document).on("mousemove",(function(e){})),$(document).on("mouseup",(function(){$(document).off("mousemove")}))}))}function getScrollBarWidthAndHeight(){let el=document.createElement("p"),styles={width:"100px",height:"100px",overflow:"scroll"};for(let i in styles)el.style[i]=styles[i];document.body.appendChild(el);let scrollBarWidth=el.offsetWidth-el.clientWidth,scrollBarHeight=el.offsetHeight-el.clientHeight;return el.remove(),[scrollBarWidth,scrollBarHeight]}$.fn.extend({cascader:function(options,data){if($(this).wrap('<div class="cascader"></div>'),"object"!=typeof options)return this;let $cascaderInput=$(this),targetId=$cascaderInput.attr("id"),classes=constants.classes,optionIdsObj={},optionObj={},html=constants.html,config=$.extend({},defaults,options),cascader={targetId:targetId,config:config},scrollbarWidthAndHeight=getScrollBarWidthAndHeight(),scrollbarWidth=scrollbarWidthAndHeight[0],scrollbarHeight=scrollbarWidthAndHeight[1];$cascaderInput.attr(constants.defaultAttrs).after(html.dropdown(targetId)),config.disabled&&$cascaderInput.attr("disabled","disabled");let $cascader=$cascaderInput.parent(".cascader"),$cascader_dropdown=$cascaderInput.siblings(".cascader-dropdown"),$cascader_panel=$("#cascader_panel_"+targetId);$.each(data,(function(i,option){let id=$.trim(option[config.idKey]),pId=$.trim(option[config.pIdKey]);optionObj[id]=option,$.isEmptyObject(optionIdsObj[pId])&&(optionIdsObj[pId]={}),optionIdsObj[pId][id]=option}));let nodeHtml=[];return $.each(optionIdsObj[config.rootPId],(function(i,option){option.isParent=!$.isEmptyObject(optionIdsObj[option[config.idKey]]),void 0!==option.level&&null!==option.level||(option.level=1);let index=config.sortKey?option[config.sortKey]:i;nodeHtml[index]=html.node(option,config)})),$cascader_panel.append(html.menu(nodeHtml.join(""),1,targetId,-scrollbarWidth+"px",-scrollbarHeight+"px")),$cascaderInput.on("click",(function(){$cascaderInput.hasClass("is-invalid")&&$cascaderInput.removeClass("is-invalid"),$cascader.hasClass(classes.isFocus)?closePanel($cascader,$cascader_dropdown):(adjustPanelDirection($cascaderInput,$cascader_dropdown),$cascader_dropdown.addClass(classes.zoomInTopEnterActive).addClass(classes.zoomInTopEnter),$cascader.addClass(classes.isFocus),setTimeout((function(){$cascader_dropdown.removeClass(classes.zoomInTopEnter)}),7),setTimeout((function(){$cascader_dropdown.removeClass(classes.zoomInTopEnterActive),initScrollbar(targetId,1,scrollbarHeight)}),300))})),$cascaderInput.parent().on("mouseover",(function(){$cascaderInput.val()&&$cascaderInput.next(".input-suffix").addClass("event-auto").children(".iconfont").removeClass("icon-arrow-up").addClass("icon-close-s")})).on("mouseout",(function(){$cascaderInput.next(".input-suffix").removeClass("event-auto").children(".iconfont").removeClass("icon-close-s").addClass("icon-arrow-up")})).on("click",".input-suffix",(function(){closePanel($cascader,$cascader_dropdown),$cascader_dropdown.find(".is-active").removeClass("is-active"),checkedNodes[targetId]=[],$cascaderInput.val("")})),$cascader_dropdown.on("click",".cascader-node",(function(){let $this=$(this),id=$.trim($this.attr("data-id")),level=parseInt($this.attr("data-level")),nextLevel=level+1,$menu_list=$(this).parent(".cascader-menu-list"),menuListWidth=180,right=$(document).width()-$menu_list.offset().left-180,dropdownPositionLeft=$cascader_dropdown.position().left,$popper__arrow=$cascader_dropdown.children(".popper__arrow"),arrowLeft=$popper__arrow.position().left;if(config.onClickNode(this,optionObj[id]),$this.hasClass("is-disabled"))return;let nodeHtml=[];if($.each(optionIdsObj[id],(function(i,option){option.isParent=!$.isEmptyObject(optionIdsObj[option[config.idKey]]),void 0!==option.level&&null!==option.level||(option.level=nextLevel);let index=config.sortKey?option[config.sortKey]:i;nodeHtml[index]=html.node(option,config)})),$.isEmptyObject(optionIdsObj[id])){if(right>1&&dropdownPositionLeft<0)if(-1*dropdownPositionLeft<180)$cascader_dropdown.removeAttr("style"),$popper__arrow.removeAttr("style");else{let leftMinus=right/180*180;dropdownPositionLeft+leftMinus>0?($cascader_dropdown.removeAttr("style"),$popper__arrow.removeAttr("style")):($cascader_dropdown.css("left",dropdownPositionLeft+leftMinus),$popper__arrow.css("left",arrowLeft+leftMinus))}$this.addClass(classes.active).siblings().removeClass(classes.active).removeClass(classes.activePath),$("#cascader_menu_"+targetId+"_"+level).nextAll().remove();let valNames="",nodes=[];$("#cascader_panel_"+targetId).find(".cascader-node.in-active-path").each((function(i,node){let id=$.trim($(node).attr("data-id"));valNames+=$(node).children(".cascader-node-label").text()+config.separator,nodes.push(optionObj[id])})),nodes.push(optionObj[id]),checkedNodes[targetId]=nodes,$cascaderInput.val(valNames+$this.children(".cascader-node-label").text()),$cascaderInput.hasClass("is-invalid")&&$cascaderInput.removeClass("is-invalid"),closePanel($cascader,$cascader_dropdown)}else{$this.addClass(classes.activePath).siblings().removeClass(classes.activePath).removeClass(classes.active);let $cascader_menu=$("#cascader_menu_"+targetId+"_"+nextLevel);if($cascader_menu.length>0?$("#cascader_menu_"+targetId+"_"+nextLevel+" .cascader-menu-list").html(nodeHtml.join("")):$cascader_panel.append(html.menu(nodeHtml.join(""),nextLevel,targetId,-scrollbarWidth+"px",-scrollbarHeight+"px")),$cascader_menu.nextAll().remove(),initScrollbar(targetId,nextLevel,scrollbarHeight),right<180){let left=$cascader_dropdown.position().left-(180-right),arrowLeft=$popper__arrow.position().left+(180-right);$cascader_dropdown.css("left",left),$popper__arrow.css("left",arrowLeft)}else if(right>180){if(0===dropdownPositionLeft)return;if(-1*dropdownPositionLeft<180)$cascader_dropdown.removeAttr("style"),$popper__arrow.removeAttr("style");else{let leftMinus=180*(right/180-1);if(dropdownPositionLeft+leftMinus>0)return $cascader_dropdown.removeAttr("style"),void $popper__arrow.removeAttr("style");$cascader_dropdown.css("left",dropdownPositionLeft+leftMinus),$popper__arrow.css("left",arrowLeft+leftMinus)}}}})),$(document).on("click",(function(e){$cascader.is(e.target)||0!==$cascader.has(e.target).length||$cascader.hasClass(classes.isFocus)&&closePanel($cascader,$cascader_dropdown)})),$cascader.parents().scroll((function(){adjustPanelDirection($cascaderInput,$cascaderInput.siblings(".cascader-dropdown"))})),cascaderObjs[targetId]=$.extend({},cascader,methods),cascaderObjs[targetId]}}),$.fn.sp_cascader={getCascaderObj:function(cascaderId){let o=cascaderObjs[cascaderId];return o||null}}}(jQuery);