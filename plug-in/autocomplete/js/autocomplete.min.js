/*!
 * 文本框自动填充 autocomplete v1.0.0
 *
 * 作者：王金城
 * 日期：2021年5月27日
 */
!function($){let constants={classes:{zoomInTopLeaveActive:"el-zoom-in-top-leave-active",zoomInTopEnter:"el-zoom-in-top-enter",zoomInTopEnterActive:"el-zoom-in-top-enter-active",isFocus:"is-focus",cascader:"cascader",elPopper:"el-popper",popperArrow:"popper__arrow",activePath:"in-active-path",active:"is-active",d_block:"d-block"},html:{dropdown:function(targetId,scrollbarWidth,scrollbarHeight){let panel;return'<div class="autocomplete-dropdown el-popper" x-placement="bottom-start">  <div class="popper__arrow"></div>  <div class="autocomplete-panel el-scrollbar" id="autocomplete_panel_'+targetId+'">'+('<div class="autocomplete-menu-wrap el-scrollbar__wrap" style="margin-right:'+scrollbarWidth+";margin-bottom:"+scrollbarHeight+';">  <ul class="el-scrollbar__view autocomplete" id="autocomplete_'+targetId+'"></ul></div><div class="el-scrollbar__bar is-horizontal"><div class="el-scrollbar__thumb"></div></div><div class="el-scrollbar__bar is-vertical"><div class="el-scrollbar__thumb"></div></div>')+"</div></div>"},li:function(data){let html="";return $.each(data,(function(i,n){html+='<li data-value="'+n.value+'">'+n.name+"</li>"})),html}}};function adjustPanelDirection($this,$cascader_dropdown){if($this&&$cascader_dropdown&&$this.length>0&&$cascader_dropdown.length>0){let bottom;$(window).height()-($this.offset().top-$(document).scrollTop())<=250?$cascader_dropdown.attr("x-placement","top-start"):$cascader_dropdown.attr("x-placement","bottom-start")}}function closePanel($autocomplete,$autocomplete_dropdown){if($autocomplete&&$autocomplete_dropdown&&$autocomplete.length>0&&$autocomplete_dropdown.length>0){let classes=constants.classes;$autocomplete_dropdown.addClass(classes.zoomInTopLeaveActive).addClass(classes.d_block),$autocomplete.removeClass(classes.isFocus),setTimeout((function(){$autocomplete_dropdown.removeClass(constants.classes.zoomInTopLeaveActive).removeClass(classes.d_block)}),300)}}function initScrollbar(targetId,$scrollbar__wrap,$scrollbar__thumb,scrollbarHeight,wrapHeight){let $scrollbar__view=$("#autocomplete_panel_"+targetId+" .el-scrollbar__view");if(0===$scrollbar__view.length)return!1;let viewHeight=$scrollbar__view[0].scrollHeight;wrapHeight<viewHeight?$scrollbar__thumb.css("height",wrapHeight/viewHeight*100+"%"):$scrollbar__thumb.css("height",0),setTimeout((function(){initScrollbar(targetId,$scrollbar__wrap,$scrollbar__thumb,scrollbarHeight,wrapHeight)}),100)}function getScrollBarWidthAndHeight(){let el=document.createElement("p"),styles={width:"100px",height:"100px",overflow:"scroll"};for(let i in styles)el.style[i]=styles[i];document.body.appendChild(el);let scrollBarWidth=el.offsetWidth-el.clientWidth,scrollBarHeight=el.offsetHeight-el.clientHeight;return el.remove(),[scrollBarWidth,scrollBarHeight]}$.fn.extend({autocomplete:function(data){if("object"!=typeof data)return this;if($.isEmptyObject(data))return this;$(this).wrap('<div class="autocomplete-box"></div>');let $autocompleteInput=$(this),targetId=$autocompleteInput.attr("id"),classes=constants.classes,html=constants.html,scrollbarWidthAndHeight=getScrollBarWidthAndHeight(),scrollbarWidth=scrollbarWidthAndHeight[0],scrollbarHeight=scrollbarWidthAndHeight[1];$autocompleteInput.after(html.dropdown(targetId,-scrollbarWidth+"px",-scrollbarHeight+"px"));let $autocompleteView=$("#autocomplete_"+targetId);$autocompleteView.html(html.li(data)),data.length>8&&$autocompleteView.parent().addClass("max-height");let $autocomplete=$autocompleteInput.parent(".autocomplete-box"),$autocomplete_dropdown=$autocompleteInput.siblings(".autocomplete-dropdown"),$scrollbar__wrap=$("#autocomplete_panel_"+targetId+" .el-scrollbar__wrap"),$scrollbar__thumb=$("#autocomplete_panel_"+targetId+" .el-scrollbar__bar.is-vertical .el-scrollbar__thumb"),wrapHeight=$scrollbar__wrap.height()-scrollbarHeight;return initScrollbar(targetId,$scrollbar__wrap,$scrollbar__thumb,scrollbarHeight,wrapHeight),$scrollbar__wrap.on("scroll",(function(){$scrollbar__thumb.css("transform","translateY("+$(this).scrollTop()/wrapHeight*100+"%)")})),$autocompleteInput.on("focus",(function(){$autocomplete.hasClass(classes.isFocus)||(adjustPanelDirection($autocompleteInput,$autocomplete_dropdown),$autocomplete_dropdown.addClass(classes.zoomInTopEnterActive).addClass(classes.zoomInTopEnter),$autocomplete.addClass(classes.isFocus),setTimeout((function(){$autocomplete_dropdown.removeClass(classes.zoomInTopEnter)}),7),setTimeout((function(){$autocomplete_dropdown.removeClass(classes.zoomInTopEnterActive)}),300),$autocompleteInput.keyup())})).on("keyup",(function(){let searchKey=$.trim($(this).val()),$autocomplete_li=$("#autocomplete_"+targetId+" li");searchKey?$autocomplete_li.addClass("d-none").filter(':contains("'+searchKey+'")').removeClass("d-none"):$autocomplete_li.removeClass("d-none");let showLiLength=$("#autocomplete_"+targetId+" li:not(.d-none)").length;0!==showLiLength?($autocompleteInput.focus(),showLiLength>8?$("#autocomplete_"+targetId).parent().addClass("max-height"):$("#autocomplete_"+targetId).parent().removeClass("max-height")):closePanel($autocomplete,$autocomplete_dropdown)})),$autocompleteView.on("click","li",(function(){let value=$.trim($(this).attr("data-value"));value||$.trim($(this).text()),$autocompleteInput.val(value),closePanel($autocomplete,$autocomplete_dropdown)})),$(document).on("click",(function(e){$autocomplete.is(e.target)||0!==$autocomplete.has(e.target).length||$autocomplete.hasClass(classes.isFocus)&&closePanel($autocomplete,$autocomplete_dropdown)})),$(document).scroll((function(){adjustPanelDirection($autocompleteInput,$autocompleteInput.siblings(".autocomplete-dropdown"))})),$autocompleteInput}})}(jQuery);