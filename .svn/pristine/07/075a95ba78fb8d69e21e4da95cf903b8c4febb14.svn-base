/*!
 * cascader v1.0.1
 *
 * 作者：王金城
 * 日期：2019年10月15日
 */
(function(e){let constants={icons:{inputSuffix:'<i class="iconfont icon-arrow-up input-suffix"></i>',nodePostfix:'<i class="iconfont icon-arrow-up cascader-node-postfix"></i>',nodePrefix:'<i class="iconfont icon-check cascader-node-prefix"></i>'},classes:{zoomInTopLeaveActive:"el-zoom-in-top-leave-active",zoomInTopEnter:"el-zoom-in-top-enter",zoomInTopEnterActive:"el-zoom-in-top-enter-active",isFocus:"is-focus",cascader:"cascader",elPopper:"el-popper",popperArrow:"popper__arrow",activePath:"in-active-path",active:"is-active",d_block:"d-block"},defaultAttrs:{type:"text",autocomplete:"off",readonly:"readonly"},html:{dropdown:function(f){return'<div class="input-suffix"><i class="iconfont icon-arrow-up"></i></div><div class="cascader-dropdown el-popper" x-placement="bottom-start">  <div class="popper__arrow"></div>  <div class="cascader-panel" id="cascader_panel_'+f+'"></div></div>'},menu:function(f,k,g,h,j){return'<div class="el-scrollbar cascader-menu" role="menu" id="cascader_menu_'+g+"_"+k+'">  <div class="cascader-menu-wrap el-scrollbar__wrap" style="margin-right:'+h+";margin-bottom:"+j+';">    <ul class="el-scrollbar__view cascader-menu-list">'+f+'</ul>  </div>  <div class="el-scrollbar__bar is-horizontal"><div class="el-scrollbar__thumb"></div></div>  <div class="el-scrollbar__bar is-vertical"><div class="el-scrollbar__thumb"></div></div></div>'},node:function(g,f){let menuitem='<li class="cascader-node" role="menuitem" data-id="'+g[f.idKey]+'" data-level="'+g.level+'"><span class="cascader-node-label">'+g[f.name]+"</span>";if(g.isParent){menuitem+=constants.icons.nodePostfix}else{menuitem+=constants.icons.nodePrefix}menuitem+="</li>";return menuitem}}},defaults={idKey:"id",pIdKey:"pId",rootPId:-1,name:"name",disabled:false,separator:" / ",onClickNode:function(g,f){}},checkedNodes={},methods={val:function(f){if(f===undefined){let values=[],config=this.config;e.each(checkedNodes[this.targetId],function(g,h){values.push(h[config.idKey])});return values}else{if(!e.isEmptyObject(f)){let targetId=this.targetId;e("#"+targetId).siblings(".cascader-dropdown").css({opacity:0,display:"block"});for(let i=0;i<f.length;i++){let $node=e("#cascader_panel_"+targetId).find(".cascader-node[data-id="+f[i]+"]");if($node.index()>5){$node.parents(".el-scrollbar__wrap").animate({scrollTop:35*($node.index()-3)},20)}$node.click()}setTimeout(function(){e("#"+targetId).siblings(".cascader-dropdown").css({opacity:"",display:""})},300)}}},getCheckedNodes:function(f){let nodes=checkedNodes[this.targetId];if(f===undefined||f===false){return nodes||[]}if(!e.isEmptyObject(nodes)){for(let i=nodes.length-1;i>=0;i--){let node=nodes[i];if(!node.isParent){return node}}}return{}}};e.fn.extend({cascader:function(f,g){e(this).wrap('<div class="cascader"></div>');if(typeof f!=="object"){return this}let $cascaderInput=e(this),targetId=$cascaderInput.attr("id"),classes=constants.classes,optionIdsObj={},optionObj={},html=constants.html,config=e.extend({},defaults,f),cascader={targetId:targetId,config:config},scrollbarWidthAndHeight=b(),scrollbarWidth=scrollbarWidthAndHeight[0],scrollbarHeight=scrollbarWidthAndHeight[1];$cascaderInput.attr(constants.defaultAttrs).after(html.dropdown(targetId));if(config.disabled){$cascaderInput.attr("disabled","disabled")}let $cascader=$cascaderInput.parent(".cascader"),$cascader_dropdown=$cascaderInput.siblings(".cascader-dropdown"),$cascader_panel=e("#cascader_panel_"+targetId);e.each(g,function(h,j){let id=e.trim(j[config.idKey]),pId=e.trim(j[config.pIdKey]);optionObj[id]=j;if(e.isEmptyObject(optionIdsObj[pId])){optionIdsObj[pId]={}}optionIdsObj[pId][id]=j});let nodeHtml="";e.each(optionIdsObj[config.rootPId],function(h,j){j.isParent=!e.isEmptyObject(optionIdsObj[j[config.idKey]]);if(j.level===undefined||j.level===null){j.level=1}nodeHtml+=html.node(j,config)});$cascader_panel.append(html.menu(nodeHtml,1,targetId,-scrollbarWidth+"px",-scrollbarHeight+"px"));$cascaderInput.on("click",function(){if($cascader.hasClass(classes.isFocus)){a($cascader,$cascader_dropdown)}else{c($cascaderInput,$cascader_dropdown);$cascader_dropdown.addClass(classes.zoomInTopEnterActive).addClass(classes.zoomInTopEnter);$cascader.addClass(classes.isFocus);setTimeout(function(){$cascader_dropdown.removeClass(classes.zoomInTopEnter)},7);setTimeout(function(){$cascader_dropdown.removeClass(classes.zoomInTopEnterActive);d(targetId,1,scrollbarHeight)},300)}});$cascader_dropdown.on("click",".cascader-node",function(){let $this=e(this),id=e.trim($this.attr("data-id")),level=parseInt($this.attr("data-level")),nextLevel=level+1;config.onClickNode(this,optionObj[id]);let nodeHtml="";e.each(optionIdsObj[id],function(h,j){j.isParent=!e.isEmptyObject(optionIdsObj[j[config.idKey]]);if(j.level===undefined||j.level===null){j.level=nextLevel}nodeHtml+=html.node(j,config)});if(e.isEmptyObject(optionIdsObj[id])){$this.addClass(classes.active).siblings().removeClass(classes.active).removeClass(classes.activePath);e("#cascader_menu_"+targetId+"_"+level).nextAll().remove();let valNames="",nodes=[];e("#cascader_panel_"+targetId).find(".cascader-node.in-active-path").each(function(h,j){let id=e.trim(e(j).attr("data-id"));valNames+=e(j).children(".cascader-node-label").text()+config.separator;nodes.push(optionObj[id])});nodes.push(optionObj[id]);checkedNodes[targetId]=nodes;$cascaderInput.val(valNames+$this.children(".cascader-node-label").text());a($cascader,$cascader_dropdown)}else{$this.addClass(classes.activePath).siblings().removeClass(classes.activePath).removeClass(classes.active);let $cascader_menu=e("#cascader_menu_"+targetId+"_"+nextLevel);if($cascader_menu.length>0){e("#cascader_menu_"+targetId+"_"+nextLevel+" .cascader-menu-list").html(nodeHtml)}else{$cascader_panel.append(html.menu(nodeHtml,nextLevel,targetId,-scrollbarWidth+"px",-scrollbarHeight+"px"))}$cascader_menu.nextAll().remove();d(targetId,nextLevel,scrollbarHeight)}});e(document).on("click",function(h){if(!$cascader.is(h.target)&&$cascader.has(h.target).length===0){if($cascader.hasClass(classes.isFocus)){a($cascader,$cascader_dropdown)}}});e(document).scroll(function(){c($cascaderInput,$cascaderInput.siblings(".cascader-dropdown"))});return e.extend({},cascader,methods)}});function c(f,g){if(f&&g&&f.length>0&&g.length>0){let bottom=e(window).height()-(f.offset().top-e(document).scrollTop());if(bottom<=250){g.attr("x-placement","top-start")}else{g.attr("x-placement","bottom-start")}}}function a(f,g){if(f&&g&&f.length>0&&g.length>0){let classes=constants.classes;g.addClass(classes.zoomInTopLeaveActive).addClass(classes.d_block);f.removeClass(classes.isFocus);setTimeout(function(){g.removeClass(classes.zoomInTopLeaveActive).removeClass(classes.d_block)},300)}}function d(f,h,g){let $scrollbar__wrap=e("#cascader_menu_"+f+"_"+h+" .el-scrollbar__wrap"),$scrollbar__thumb=e("#cascader_menu_"+f+"_"+h+" .el-scrollbar__bar.is-vertical .el-scrollbar__thumb"),wrapHeight=$scrollbar__wrap.height()-g,viewHeight=e("#cascader_menu_"+f+"_"+h+" .el-scrollbar__view")[0].scrollHeight;if(wrapHeight<viewHeight){$scrollbar__thumb.css("height",(wrapHeight/viewHeight*100)+"%")}$scrollbar__wrap.off("scroll");$scrollbar__wrap.on("scroll",function(){$scrollbar__thumb.css("transform","translateY("+(e(this).scrollTop()/wrapHeight*100)+"%)")});$scrollbar__thumb.off("mousedown");$scrollbar__thumb.on("mousedown",function(j){if(j.button===0){let gapY=j.clientY;console.log(gapY)}e(document).on("mousemove",function(k){});e(document).on("mouseup",function(){e(document).off("mousemove")})})}function b(){let el=document.createElement("p"),styles={width:"100px",height:"100px",overflow:"scroll"};for(let i in styles){el.style[i]=styles[i]}document.body.appendChild(el);let scrollBarWidth=el.offsetWidth-el.clientWidth,scrollBarHeight=el.offsetHeight-el.clientHeight;el.remove();return[scrollBarWidth,scrollBarHeight]}})(jQuery);